<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Friend survey</title>

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"
        integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o"
        crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Bubblegum+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Satisfy&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./survey.css">

</head>

<body>

    <div class="container">
        <br>
        <h1 id="head">Survey Questions</h1>
        <br>
        <h1 id="about">About You</h1>
        <hr>
        <div id="questionsContainer">
        </div>

        <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit" data-toggle="modal"
            data-target="#exampleModal"><i class="fa fa-check-circle" aria-hidden="true"></i>
            Submit</button>

        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content" id="modalBack">

                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Results</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <div class="modal-body">
                        <h2 class="drumrollPlease">The character you are closest to is...</h2>
                        <hr>
                        <div class="matchName">Loading..</div>
                        <br>
                        <div class="picContainer"><img src="" alt="" class="matchPic"></div>
                        <br>
                        <h3 id="startOverText">Click below to start over!</h3>
                        <br>
                        <a href="#">
                            <button type="button" class="btn btn-lg btn-primary" id="tryAgain" data-dismiss="modal"
                                aria-label="Close">
                                Try again
                            </button>
                        </a>
                    </div>

                </div>
            </div>
        </div>
    </div>
    </div>

    <script>

        const questions = [
            "The safety of others is of the utmost importance.",
            "I got my mind on my money and my money on my mind.",
            "I enjoy creating music.",
            "I enjoy being mischievous.",
            "The meaning of life is romance.",
            "I love wine.",
            "I enjoy DIY projects or fixing broken things around the house.",
            "Farts are hilarious.",
            "I like to sing and dance.",
            "Do you think horses get songs stuck in their heads?",
        ]

        for (let i = 0; i < questions.length; i++) {
            let newQuestion = (`
            <div class="quest">
            <h3>Question #${i + 1}</h3>
            <br>
            <h4>${questions[i]}</h4>
            <br>
            <select class="chosen-select question-select" id="q${i + 1}">
            <option selected value=0>Click to select an option</option>
            <option value=1>1 (Strongly Disagree)</option>
            <option value=2>2</option>
            <option value=3>3</option>
            <option value=4>4</option>
            <option value=5>5 (Strongly Agree)</option>
            </select>
            <br><br>
            </div>
            `)
            $("#questionsContainer").append(newQuestion)
        }

        $("#tryAgain").on("click", function () {
            location.reload();
        })

        $("#submit").on("click", function () {
            $("html, body").animate({
                scrollTop: 0
            }, 500);
            var newCharacter = {
                name: $("#name").val(),
                scores: [
                    $("#q1").val(),
                    $("#q2").val(),
                    $("#q3").val(),
                    $("#q4").val(),
                    $("#q5").val(),
                    $("#q6").val(),
                    $("#q7").val(),
                    $("#q8").val(),
                    $("#q9").val(),
                    $("#q10").val()
                ]
            }
            $.post("/api/friends", newCharacter,
                function (data) {
                    if (data) {
                        getBest()
                    }
                }
            );

            function getBest() {
                $.get("/api/friends", function (data) {
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].scores === "match") {
                            $(".matchName").html(data[i].name)
                            $(".matchPic").attr("src", data[i].photo)
                        }
                    }
                });
            }
        })
    </script>

</body>

</html>